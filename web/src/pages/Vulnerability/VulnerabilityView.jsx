import {
  Box,
  Card,
  Chip,
  List,
  ListItem,
  ListItemIcon,
  ListItemText,
  Typography,
} from "@mui/material";
import PropTypes from "prop-types";

import { ActionTypeIcon } from "../../components/ActionTypeIcon";
import { ArtifactTagView } from "../../components/ArtifactTagView";

export function VulnerabilityView(props) {
  const { topic, topicActions, matchedTopicTag, service } = props;

  return (
    <>
      {/* Artifact Tag */}
      <Box>
        <Typography variant="h6" sx={{ fontWeight: "bold" }}>
          Artifact Tag
        </Typography>
        <ArtifactTagView artifactTag={matchedTopicTag} topicActions={topicActions} />
      </Box>
      {/* Mitigations -- show actions currently */}
      <Box>
        <Typography variant="h6" sx={{ fontWeight: "bold" }}>
          Mitigations
        </Typography>
        <Card variant="outlined" sx={{ m: 1, p: 2 }}>
          <List>
            {topicActions.length === 0 ? (
              <ListItem>
                <ListItemText primary={"No data"} />
              </ListItem>
            ) : (
              topicActions.map((action) => (
                <ListItem key={action.action_id}>
                  <ListItemIcon>
                    <ActionTypeIcon
                      actionType={action.action_type}
                      disabled={!action.recommended}
                    />
                  </ListItemIcon>
                  <ListItemText primary={action.action} />
                </ListItem>
              ))
            )}
          </List>
        </Card>
      </Box>
      {/* Topic misp tags */}
      <Box>
        <Typography variant="h6" sx={{ fontWeight: "bold" }}>
          Topic Tags
        </Typography>
        {topic.misp_tags?.length > 0 ? (
          topic.misp_tags.map((mispTag) => (
            <Chip key={mispTag.tag_id} label={mispTag.tag_name} sx={{ m: 1 }} />
          ))
        ) : (
          <List>
            <ListItem>
              <ListItemText primary={"-"} />
            </ListItem>
          </List>
        )}
      </Box>
      {/* Topic Detail */}
      <Box>
        <Typography variant="h6" sx={{ fontWeight: "bold" }}>
          Detail
        </Typography>
        <Card variant="outlined" sx={{ m: 1, p: 2 }}>
          <Typography variant="body1">{topic.abstract}</Typography>
        </Card>
      </Box>
    </>
  );
}
VulnerabilityView.propTypes = {
  topic: PropTypes.object.isRequired,
  topicActions: PropTypes.array.isRequired,
  matchedTopicTag: PropTypes.object.isRequired,
  service: PropTypes.object.isRequired,
};
