import { Box, Chip, ListItem, ListItemButton, ListItemText } from "@mui/material";
import { blue } from "@mui/material/colors";
import PropTypes from "prop-types";

import { usePageParams } from "../../../../../hooks/usePageParams";
import { useGetDependency } from "../../api";
import { getSsvcColor } from "../utils/utils";

export function TicketListItem({ ticket, isSelected, onSelect }) {
  const { pteamId } = usePageParams();
  const { data: dependency } = useGetDependency({
    pteamId,
    dependencyId: ticket.dependency_id,
  });

  const target = dependency?.target || "Unknown Target";

  return (
    <ListItem disablePadding>
      <ListItemButton
        selected={isSelected}
        onClick={() => onSelect(ticket.ticket_id)}
        sx={{
          borderLeft: isSelected ? 4 : 4,
          borderColor: isSelected ? blue[700] : "transparent",
          pl: 4,
          "&.Mui-selected": { bgcolor: blue[50] },
        }}
      >
        <ListItemText
          primary={target}
          secondary={
            <Box component="span" sx={{ display: "flex", alignItems: "center", mt: 0.5 }}>
              <Chip
                label={ticket.ssvc_deployer_priority}
                size="small"
                color={getSsvcColor(ticket.ssvc_deployer_priority)}
                variant="outlined"
                sx={{ height: 20, fontSize: "0.7rem" }}
              />
            </Box>
          }
          slotProps={{
            primary: {
              component: "div",
              variant: "body2",
              fontWeight: isSelected ? "bold" : "normal",
              noWrap: true,
            },
            secondary: { component: "div" },
          }}
        />
      </ListItemButton>
    </ListItem>
  );
}

TicketListItem.propTypes = {
  ticket: PropTypes.shape({
    ticket_id: PropTypes.string.isRequired,
    dependency_id: PropTypes.string.isRequired,
    ssvc_deployer_priority: PropTypes.string,
  }).isRequired,
  isSelected: PropTypes.bool.isRequired,
  onSelect: PropTypes.func.isRequired,
};
