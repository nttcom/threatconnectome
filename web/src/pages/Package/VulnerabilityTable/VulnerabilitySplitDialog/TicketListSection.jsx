import { ExpandMore } from "@mui/icons-material";
import {
  Accordion,
  AccordionDetails,
  AccordionSummary,
  Box,
  Chip,
  List,
  ListItem,
  ListItemButton,
  ListItemText,
  Typography,
} from "@mui/material";
import { blue } from "@mui/material/colors";
import PropTypes from "prop-types";

import { getSsvcColor } from "./utils/utils";

export function TicketListSection({
  title,
  tickets,
  selectedId,
  onSelect,
  headerColor,
  defaultExpanded = true,
}) {
  return (
    <Accordion
      defaultExpanded={defaultExpanded}
      disableGutters
      elevation={0}
      square
      sx={{ "&:before": { display: "none" } }}
    >
      <AccordionSummary
        expandIcon={<ExpandMore />}
        sx={{
          bgcolor: headerColor,
          flexDirection: "row-reverse",
          "& .MuiAccordionSummary-expandIconWrapper.Mui-expanded": { transform: "rotate(90deg)" },
          "& .MuiAccordionSummary-content": { marginLeft: 1 },
          minHeight: 48,
        }}
      >
        <Typography variant="subtitle2" color="text.secondary" sx={{ fontWeight: "bold" }}>
          {title} ({tickets.length})
        </Typography>
      </AccordionSummary>

      <AccordionDetails sx={{ p: 0 }}>
        <List disablePadding>
          {tickets.map((ticket) => (
            <ListItem key={ticket.id} disablePadding>
              <ListItemButton
                selected={selectedId === ticket.id}
                onClick={() => onSelect(ticket.id)}
                sx={{
                  borderLeft: selectedId === ticket.id ? 4 : 4,
                  borderColor: selectedId === ticket.id ? blue[700] : "transparent",
                  pl: 4,
                  "&.Mui-selected": { bgcolor: blue[50] },
                }}
              >
                <ListItemText
                  primary={ticket.packageManager}
                  secondary={
                    <Box component="span" sx={{ display: "flex", alignItems: "center", mt: 0.5 }}>
                      <Chip
                        label={ticket.ssvc}
                        size="small"
                        color={getSsvcColor(ticket.ssvc)}
                        variant="outlined"
                        sx={{ height: 20, fontSize: "0.7rem" }}
                      />
                    </Box>
                  }
                  slotProps={{
                    primary: {
                      component: "div",
                      variant: "body2",
                      fontWeight: selectedId === ticket.id ? "bold" : "normal",
                      noWrap: true,
                    },
                    secondary: { component: "div" },
                  }}
                />
              </ListItemButton>
            </ListItem>
          ))}
        </List>
      </AccordionDetails>
    </Accordion>
  );
}

TicketListSection.propTypes = {
  title: PropTypes.string.isRequired,
  tickets: PropTypes.array.isRequired,
  selectedId: PropTypes.string,
  onSelect: PropTypes.func.isRequired,
  headerColor: PropTypes.string,
  defaultExpanded: PropTypes.bool,
};
