import { ExpandMore } from "@mui/icons-material";
import {
  Box,
  Typography,
  List,
  ListItemButton,
  ListItem,
  ListItemText,
  Accordion,
  AccordionSummary,
  AccordionDetails,
  Chip,
} from "@mui/material";
import PropTypes from "prop-types";

import { getSsvcStyles } from "../utils/styleUtils";

/**
 * 左ペイン（一覧）のコンポーネント
 */
export const ListPanel = ({
  groupedVulnerabilitiesData,
  statuses,
  selectedStatus,
  selectedIndex,
  onListItemClick,
}) => {
  return (
    <Box
      sx={{
        width: { xs: "100%", md: "40%" },
        height: "100%",
        overflowY: "auto",
        borderRight: { xs: "none", md: "1px solid #ddd" },
        bgcolor: "grey.50",
      }}
    >
      {statuses.map((status) => (
        <Accordion
          key={status}
          square
          disableGutters
          elevation={0}
          sx={{ "&:before": { display: "none" } }}
          defaultExpanded={status === "未着手"}
        >
          <AccordionSummary
            expandIcon={<ExpandMore />}
            sx={{
              bgcolor: "grey.200",
              borderBottom: "1px solid",
              borderColor: "grey.300",
            }}
          >
            <Typography component="span" sx={{ fontWeight: "bold" }}>
              {status} {`(${groupedVulnerabilitiesData[status]?.length || 0})`}
            </Typography>
          </AccordionSummary>
          <AccordionDetails sx={{ p: 0 }}>
            <List component="div" disablePadding>
              {groupedVulnerabilitiesData[status]?.length > 0 ? (
                groupedVulnerabilitiesData[status].map((vul, index) => {
                  return (
                    <ListItemButton
                      key={vul.id}
                      selected={status === selectedStatus && index === selectedIndex}
                      onClick={() => onListItemClick(status, index)}
                      sx={{
                        pl: 4,
                        borderLeft: "4px solid transparent",
                        "&.Mui-selected": {
                          borderLeftColor: "primary.main",
                          backgroundColor: "blue.50",
                          "&:hover": {
                            backgroundColor: "blue.100",
                          },
                        },
                      }}
                    >
                      <ListItemText
                        primary={
                          <Typography component="span" noWrap>
                            {vul.title}
                          </Typography>
                        }
                        secondary={
                          <Chip
                            label={vul.ssvc}
                            size="small"
                            sx={{
                              ...getSsvcStyles(vul.ssvc),
                              borderRadius: "16px",
                              mt: 0.5,
                              height: "auto",
                              "& .MuiChip-label": {
                                paddingTop: "2px",
                                paddingBottom: "2px",
                              },
                            }}
                          />
                        }
                      />
                    </ListItemButton>
                  );
                })
              ) : (
                <ListItem sx={{ pl: 4 }}>
                  <ListItemText primary="No tasks" sx={{ color: "grey.500" }} />
                </ListItem>
              )}
            </List>
          </AccordionDetails>
        </Accordion>
      ))}
    </Box>
  );
};

ListPanel.propTypes = {
  groupedVulnerabilitiesData: PropTypes.object.isRequired,
  statuses: PropTypes.array.isRequired,
  selectedStatus: PropTypes.string,
  selectedIndex: PropTypes.number.isRequired,
  onListItemClick: PropTypes.func.isRequired,
};
