import { ExpandMore } from "@mui/icons-material";
import {
  Box,
  Typography,
  List,
  ListItemButton,
  ListItem,
  ListItemText,
  Accordion,
  AccordionSummary,
  AccordionDetails,
  Chip,
} from "@mui/material";
import PropTypes from "prop-types";

import { getSsvcStyles } from "../utils/styleUtils";

/**
 * 左ペイン(一覧)のコンポーネント
 */
export const ListPanel = ({
  groupedTicketsData,
  statusGroups,
  selectedStatus,
  selectedIndex,
  onListItemClick,
}) => {
  return (
    <Box
      sx={{
        width: { xs: "100%", md: "40%" },
        height: "100%",
        overflowY: "auto",
        borderRight: { xs: "none", md: "1px solid #ddd" },
        bgcolor: "grey.50",
      }}
    >
      {statusGroups.map((statusGroup) => (
        <Accordion
          key={statusGroup}
          square
          disableGutters
          elevation={0}
          sx={{ "&:before": { display: "none" } }}
          defaultExpanded={statusGroup === "未着手"}
        >
          <AccordionSummary
            expandIcon={<ExpandMore />}
            sx={{
              bgcolor: "grey.200",
              borderBottom: "1px solid",
              borderColor: "grey.300",
            }}
          >
            <Typography component="span" sx={{ fontWeight: "bold" }}>
              {statusGroup} {`(${groupedTicketsData[statusGroup]?.length || 0})`}
            </Typography>
          </AccordionSummary>
          <AccordionDetails sx={{ p: 0 }}>
            <List component="div" disablePadding>
              {groupedTicketsData[statusGroup]?.length > 0 ? (
                groupedTicketsData[statusGroup].map((ticket, index) => {
                  return (
                    <ListItemButton
                      key={ticket.id}
                      selected={statusGroup === selectedStatus && index === selectedIndex}
                      onClick={() => onListItemClick(statusGroup, index)}
                      sx={{
                        pl: 4,
                        borderLeft: "4px solid transparent",
                        "&.Mui-selected": {
                          borderLeftColor: "primary.main",
                          backgroundColor: "blue.50",
                          "&:hover": {
                            backgroundColor: "blue.100",
                          },
                        },
                      }}
                    >
                      <ListItemText
                        primary={
                          <Typography component="span" noWrap>
                            {ticket.target}
                          </Typography>
                        }
                        secondary={
                          <Box component="span" sx={{ display: "inline-block" }}>
                            <Chip
                              label={ticket.ssvc}
                              size="small"
                              sx={{
                                ...getSsvcStyles(ticket.ssvc),
                                borderRadius: "16px",
                                mt: 0.5,
                                height: "auto",
                                "& .MuiChip-label": {
                                  paddingTop: "2px",
                                  paddingBottom: "2px",
                                },
                              }}
                            />
                          </Box>
                        }
                        secondaryTypographyProps={{ component: "span" }}
                      />
                    </ListItemButton>
                  );
                })
              ) : (
                <ListItem sx={{ pl: 4 }}>
                  <ListItemText primary="No tickets" sx={{ color: "grey.500" }} />
                </ListItem>
              )}
            </List>
          </AccordionDetails>
        </Accordion>
      ))}
    </Box>
  );
};

ListPanel.propTypes = {
  groupedTicketsData: PropTypes.object.isRequired,
  statusGroups: PropTypes.array.isRequired,
  selectedStatus: PropTypes.string,
  selectedIndex: PropTypes.number.isRequired,
  onListItemClick: PropTypes.func.isRequired,
};
